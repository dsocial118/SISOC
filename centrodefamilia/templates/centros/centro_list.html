{% extends "includes/main.html" %}
{% load static %}
{% block title %}Centros de Familia{% endblock %}
{% block breadcrumb %}
    <ol class="breadcrumb float-sm-right">
        <li class="breadcrumb-item">
            <a href="{% url 'centro_list' %}">Centro de Familia</a>
        </li>
        <li class="breadcrumb-item active">Listar</li>
    </ol>
{% endblock %}
{% block content %}
    <!-- Estilos modernos reutilizables para listados -->
    <link rel="stylesheet" href="{% static 'custom/css/listModerno.css' %}" />
    {% url 'centros_ajax' as ajax_url %}
    <!-- Variables para evitar problemas de formateo -->
    {% with titulo_search='Buscar Centro' %}
        {% with placeholder_text='Buscar por nombre, dirección o tipo' %}
            {% with help_text='Buscar por nombre, dirección o tipo' %}
                {% with reset_url_name='centro_list' %}
                    {% with add_url_name='centro_create' %}
                        {% with tbody_id='centros-table-body' %}
                            {% include 'components/search_bar.html' with titulo=titulo_search placeholder=placeholder_text help_text=help_text reset_url=reset_url_name add_url=add_url_name add_text='Agregar' additional_buttons=centro_additional_buttons query=request.GET.busqueda filters_mode=filters_mode filters_js=filters_js filters_action=filters_action %}
                        {% endwith %}
                    {% endwith %}
                {% endwith %}
            {% endwith %}
        {% endwith %}
    {% endwith %}
    <!-- Centros Table with AJAX -->
    <div class="row mt-5 max-width-100">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <table class="table table-bordered table-striped projects">
                        <thead>
                            <tr>
                                {% for header in table_headers %}
                                    <th {% if header.sortable %}class="sortable {{ header.class|default:'' }}" data-column="{{ header.sort_key|default:header.title }}"{% elif header.class %}class="{{ header.class }}"{% endif %}
                                        {% if header.style %}style="{{ header.style }}"{% endif %}>
                                        {{ header.title }}
                                        {% if header.sortable %}<i class="fas fa-sort sort-icon"></i>{% endif %}
                                    </th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody id="centros-table-body">
                            {% for centro in centros %}
                                <tr>
                                    <td data-nombre="{{ centro.nombre }}">
                                        <a href="{% url 'centro_detail' centro.id %}"
                                           class="font-weight-bold link-handler"
                                           title="Ver detalles">{{ centro.nombre }}</a>
                                    </td>
                                    <td data-tipo="{{ centro.get_tipo_display }}">{{ centro.get_tipo_display }}</td>
                                    <td data-calle="{{ centro.calle }}">{{ centro.calle }}</td>
                                    <td data-telefono="{{ centro.telefono }}">{{ centro.telefono }} / {{ centro.celular }}</td>
                                    <td data-activo="{% if centro.activo %}Activo{% else %}Inactivo{% endif %}">
                                        {% if centro.activo %}
                                            <span class="badge badge-success">Activo</span>
                                        {% else %}
                                            <span class="badge badge-danger">Inactivo</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="action-buttons" role="group">
                                            <a href="{% url 'centro_detail' centro.id %}"
                                               class="btn btn-primary"
                                               title="Ver detalle del centro">
                                                <i class="fas fa-eye"></i>
                                                Ver
                                            </a>
                                            <a href="{% url 'centro_update' centro.id %}"
                                               class="btn btn-editar"
                                               title="Editar centro">
                                                <i class="fas fa-edit"></i>
                                                Editar
                                            </a>
                                            {% if request.user.is_superuser or request.user.groups.all.0.name == 'CDF SSE' %}
                                                <form method="post"
                                                      action="{% url 'centro_delete' centro.id %}"
                                                      style="display:inline">
                                                    {% csrf_token %}
                                                    <button type="submit"
                                                            class="btn btn-eliminar"
                                                            title="Eliminar centro"
                                                            onclick="return confirm('¿Estás seguro de que deseas eliminar este centro? Esta acción no se puede deshacer.');">
                                                        <i class="fas fa-trash-alt"></i>
                                                        Eliminar
                                                    </button>
                                                </form>
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="6" class="text-center">No se encontraron centros.</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <div id="pagination-container">
                        {% include 'components/pagination.html' with is_paginated=is_paginated page_obj=page_obj query=request.GET.busqueda prev_text='Volver' next_text='Continuar' %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block customJS %}
    <!-- Script de ordenamiento reutilizable para tablas -->
    <script src="{% static 'custom/js/listSort.js' %}"></script>
{% endblock %}
