{% extends "includes/main.html" %}
{% load static %}
{% block title %}Importar Expedientes{% endblock %}
{% block breadcrumb %}
    <ol class="breadcrumb float-sm-right">
        <li class="breadcrumb-item">
            <a href="{% url 'importarexpedientes_list' %}">Importar Expedientes</a>
        </li>
        <li class="breadcrumb-item active">Listar</li>
    </ol>
{% endblock %}
{% block content %}
    <link rel="stylesheet" href="{% static 'custom/css/cardsDetail.css' %}" />
    <!-- Estilos modernos reutilizables para listados -->
    <link rel="stylesheet" href="{% static 'custom/css/listModerno.css' %}" />
    {% url 'importarexpediente_detail_ajax' batch_id as ajax_url %}
    {% include 'components/search_bar.html' with titulo='Buscar Errores' placeholder='Buscar por Fila' help_text='Ingresar una Fila.' reset_url='importarexpedientes_list' ajax_search_mode=True ajax_url=ajax_url target_tbody_id='importarexpedientes-tbody' query=query %}

    <div class="row text-center mb-3">
        <div class="col-xl-2 col-lg-4 col-md-4 col-sm-6 pt-3">
            <div class="info-card bg-card">
                <div class="row">
                    <div class="col-3">
                        <i class="fa fa-clipboard fa-2x"></i>
                    </div>
                    <div class="col-9 text-start">
                        <p>{{ exito_count }}</p>
                    </div>
                </div>
                <div class="row info-card-label">
                    <h5 class="mt-2">Registros Válidos</h5>
                </div>
            </div>
        </div>

        <div class="col-xl-2 col-lg-4 col-md-4 col-sm-6 pt-3">
            <div class="info-card bg-card">
                <div class="row">
                    <div class="col-3">
                        <i class="fa fa-clipboard fa-2x"></i>
                    </div>
                    <div class="col-9 text-start">
                        <p>{{ error_count }}</p>
                    </div>
                </div>
                <div class="row info-card-label">
                    <h5 class="mt-2">Registros con Errores</h5>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-xl-2 col-lg-4 col-md-4 col-sm-6 pt-3">
            <div class="row">
                <div class="col-12">
                    <div class="action-buttons d-flex gap-2">
                        <form method="post"
                              action="{% url 'importar_datos' batch_id %}"
                              class="d-inline">
                            {% csrf_token %}
                            <button type="submit"
                                    class="btn btn-primary flex-grow-1"
                                    title="Importar datos"
                                    onclick="return confirm('¿Confirmar importación del lote?');">
                                <i class="fas fa-upload"></i>
                                Completar Importación
                            </button>
                        </form>
                        <form method="post"
                              action="{% url 'borrar_datos_importados' batch_id %}"
                              class="d-inline">
                            {% csrf_token %}
                            <button type="submit"
                                    class="btn btn-danger flex-grow-1"
                                    title="Borrar datos"
                                    onclick="return confirm('¿Confirmar borrado de datos importados del lote?');">
                                <i class="fas fa-trash"></i>
                                Eliminar Archivo
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-5 max-width-100">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <table class="table table-bordered table-striped projects">
                        <thead>
                            <tr>
                                <th class="sortable" data-column="nombre">
                                    Archivo
                                    <i class="fas fa-sort sort-icon"></i>
                                </th>
                                <th class="sortable" data-column="telefono">
                                    Fila
                                    <i class="fas fa-sort sort-icon"></i>
                                </th>
                                <th class="sortable" data-column="email">
                                    Error
                                    <i class="fas fa-sort sort-icon"></i>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="importarexpedientes-tbody">
                            {% include 'partials/importarexpediente_detail_rows.html' with importarexpedientes=registros_del_archivo %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div id="pagination-container">
        {% include 'components/pagination.html' with is_paginated=is_paginated page_obj=page_obj query=query prev_text='Volver' next_text='Continuar' %}
    </div>
{% endblock %}
{% block customJS %}
    <!-- Script de ordenamiento reutilizable para tablas -->
    <script src="{% static 'custom/js/listSort.js' %}"></script>
{% endblock %}
