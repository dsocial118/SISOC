{% extends "includes/main.html" %}
{% load static custom_filters %}
{% block title %}Centro Desarrollo Infantil{% endblock %}
{% block breadcrumb %}
    {% include 'components/breadcrumb.html' with items=breadcrumb_items %}
{% endblock %}
{% block content %}
    <!-- Estilos modernos reutilizables para listados -->
    <link rel="stylesheet" href="{% static 'custom/css/listModerno.css' %}" />
    {% url 'cdi_ajax' as ajax_url %}
    <!-- Variables para evitar problemas de formateo -->
    {% with titulo_search='Buscar Centro Desarrollo Infantil' %}
        {% with placeholder_text='Buscar por nombre, numero expediente, numero repi, organizacion, provincia, telefono o email' %}
            {% with help_text='Ingresar nombre, CUIT, telefono o email.' %}
                {% with reset_url_name='cdi' %}
                    {% with add_url_name='cdi_crear' %}
                        {% with tbody_id='cdi-table-body' %}
                            {% url 'cdi_exportar' as export_url %}
                            {% include 'components/search_bar.html' with titulo=titulo_search placeholder=placeholder_text help_text=help_text reset_url=reset_url_name add_url=add_url_name query=query add_text='Agregar' ajax_search_mode=True ajax_url=ajax_url target_tbody_id=tbody_id export_url=export_url %}
                        {% endwith %}
                    {% endwith %}
                {% endwith %}
            {% endwith %}
        {% endwith %}
    {% endwith %}
    <!-- CDI Data Table with AJAX -->
    <div class="row mt-3 max-width-100">
        <div class="col-12 mt-4">
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped projects">
                            <thead>
                                <tr>
                                    {% for header in table_headers %}
                                        <th {% if header.sortable %}class="sortable" data-column="{{ header.sort_key|default:header.title }}"{% endif %}>
                                            {{ header.title }}
                                            {% if header.sortable %}<i class="fas fa-sort sort-icon"></i>{% endif %}
                                        </th>
                                    {% endfor %}
                                    {% if show_actions %}
                                        <th style="width: 20%" class="notexport">Acciones</th>
                                    {% endif %}
                                </tr>
                            </thead>
                            <tbody id="cdi-table-body">
                                {% for item in centrodesarrolloinfantiles %}
                                    <tr>
                                        {% for field in fields %}
                                            <td data-{{ field.name }}="{{ item|getattr:field.name }}">
                                                {% if field.link_field %}
                                                    <a href="{% url field.link_url item.pk %}"
                                                       {% if field.link_class %}class="{{ field.link_class }}"{% endif %}
                                                       {% if field.link_title %}title="{{ field.link_title }}"{% endif %}>
                                                        {{ item|getattr:field.name }}
                                                    </a>
                                                {% else %}
                                                    {{ item|getattr:field.name }}
                                                {% endif %}
                                            </td>
                                        {% endfor %}
                                        {% if show_actions %}
                                            <td class="project-actions text-right">
                                                {% if actions %}
                                                    <div class="action-buttons" role="group">
                                                        {% for action in actions %}
                                                            <a href="{% url action.url_name item.pk %}"
                                                               class="btn btn-{{ action.type|default:'primary' }} {{ action.class|default:'' }}"
                                                               title="{{ action.title|default:action.label }}">
                                                                {% if action.icon %}
                                                                    <i class="fas fa-{{ action.icon }}"></i>
                                                                {% elif action.label == 'Ver' %}
                                                                    <i class="fas fa-eye"></i>
                                                                {% elif action.label == 'Editar' %}
                                                                    <i class="fas fa-edit"></i>
                                                                {% elif action.label == 'Eliminar' %}
                                                                    <i class="fas fa-trash-alt"></i>
                                                                {% endif %}
                                                                {{ action.label }}
                                                            </a>
                                                        {% endfor %}
                                                    </div>
                                                {% endif %}
                                            </td>
                                        {% endif %}
                                    </tr>
                                {% empty %}
                                    <tr>
                                        <td colspan="{% if show_actions %}{{ table_headers|length|add:1 }}{% else %}{{ table_headers|length }}{% endif %}"
                                            class="text-center text-muted py-4">
                                            No hay centros de desarrollo infantil registrados.
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="pagination-container">
        {% if is_paginated %}
            {% include 'components/pagination.html' %}
        {% endif %}
    </div>
{% endblock %}
{% block customJS %}
    <!-- Script de ordenamiento reutilizable para tablas -->
    <script src="{% static 'custom/js/listSort.js' %}"></script>
    <script src="{% static 'custom/js/export_helper.js' %}"></script>
{% endblock %}
