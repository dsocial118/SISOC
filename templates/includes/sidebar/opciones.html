{% load static custom_filters dashboard_tags %}
{% with pagina_actual=request.resolver_match.route %}
    <!-- INFORMACIÓN DE USUARIO -->
    <li class="nav-item user-info mb-2 mt-2">
        <div class="user-panel d-flex align-items-center p-3">
            <div class="user-avatar me-3">
                <div class="avatar-circle d-flex align-items-center justify-content-center bg-primary text-white rounded-circle"
                     style="width: 45px;
                            height: 45px;
                            font-size: 16px;
                            font-weight: 600">
                    {% comment %}
                    Cuando agreguen los campos 'nombres' y 'apellido' al modelo User,
                    reemplazar este bloque por:
                    {% if request.user.nombres and request.user.apellido %}
                        {{ request.user.nombres|first|upper }}{{ request.user.apellido|first|upper }}
                    {% else %}
                        {{ request.user.username|first|upper }}
                    {% endif %}
                    {% endcomment %}
                    {{ request.user.username|first|upper }}
                </div>
            </div>
            <div class="info flex-grow-1">
                <p class="mb-1 text-white fw-bold">{{ request.user.get_full_name|default:request.user.username }}</p>
                <p class="mb-0 text-white-50 small">{{ request.user.profile.rol }}</p>
            </div>
        </div>
    </li>
    <!-- INICIO -->
    <li class="nav-item nav-main-item">
        <a href="{% url 'inicio' %}"
           class="nav-link {% if 'inicio' in pagina_actual %}active{% endif %}">
            <img src="{% static 'custom/img/iconos_sidebar/inicio.svg' %}" alt="" />
            <p>Inicio</p>
        </a>
    </li>
    <li class="nav-item nav-main-item">
        <a href="{% url 'changelog' %}"
           class="nav-link {% if 'novedades' in pagina_actual %}active{% endif %}">
            <i class="nav-icon bi bi-megaphone-fill"></i>
            <p>Novedades del sistema</p>
        </a>
    </li>

    {% if request.user|has_group:"Administrador" %}
        <li class="nav-item nav-main-item">
            <a href="#" class="nav-link">
                <img src="{% static 'custom/img/iconos_sidebar/administracion.svg' %}"
                     alt="" />
                <p>
                    Administración
                    <i class="nav-arrow bi bi-chevron-right"></i>
                </p>
            </a>
            <ul class="nav nav-treeview">
                <li class="nav-item">
                    <a href="{% url 'usuarios' %}"
                       class="nav-link nav-dot ms-2 {% if 'usuarios' in pagina_actual or 'password' in pagina_actual %}active{% endif %}">
                        <p>Usuarios</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{% url 'grupos' %}"
                       class="nav-link nav-dot ms-2 {% if 'grupos' in pagina_actual %}active{% endif %}">
                        <p>Grupos</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{% url 'dupla_list' %}"
                       class="nav-link nav-dot ms-2 {% if 'dupla' in pagina_actual or 'equipo-tecnico' in pagina_actual %}active{% endif %}">
                        <p>Equipos Técnicos</p>
                    </a>
                </li>
                {% if perms.auditlog.view_logentry %}
                    <li class="nav-item">
                        <a href="{% url 'audittrail:log_list' %}"
                           class="nav-link nav-dot ms-2 {% if 'auditoria/' in pagina_actual %}active{% endif %}">
                            <p>Auditoría</p>
                        </a>
                    </li>
                {% endif %}
            </ul>
        </li>
    {% endif %}
    {% tableros_para_sidebar as tableros %}
    {% with has_dashboard_cf=request.user|has_group:"Dashboard Centrodefamilia" %}
        {% if has_dashboard_cf or tableros %}
            <!-- Tableros -->
            <li class="nav-item nav-main-item {% if 'dashboard' in pagina_actual %}menu-open{% endif %}">
                <a href="#" class="nav-link">
                    <img src="{% static 'custom/img/iconos_sidebar/tableros.svg' %}" alt="" />
                    <p>
                        Tableros
                        <i class="nav-arrow bi bi-chevron-right"></i>
                    </p>
                </a>
                <ul class="nav nav-treeview">
                    {% if has_dashboard_cf %}
                        <li class="nav-item {% if 'centro-de-familia' in pagina_actual %}menu-open{% endif %}">
                            <a href="#"
                               class="nav-link nav-dot ms-2 {% if 'centro-de-familia' in pagina_actual %}active{% endif %}">
                                <p>
                                    Centros de Familia
                                    <i class="nav-arrow bi bi-chevron-right"></i>
                                </p>
                            </a>
                            <ul class="nav nav-treeview">
                                <li class="nav-item">
                                    <a href="{% url 'dashboard' %}"
                                       class="nav-link ms-4 {% if 'centro-de-familia' in pagina_actual %}active{% endif %}">
                                        <i class="nav-icon bi bi-arrow-return-right"></i>
                                        <p>Ver</p>
                                    </a>
                                </li>
                            </ul>
                        </li>
                    {% endif %}
                    {% for tablero in tableros %}
                        {% with tablero_url=tablero.get_absolute_url %}
                            <li class="nav-item {% if request.get_full_path == tablero_url %}menu-open{% endif %}">
                                <a href="#"
                                   class="nav-link nav-dot ms-2 {% if request.get_full_path == tablero_url %}active{% endif %}">
                                    <p>
                                        {{ tablero.nombre }}
                                        <i class="nav-arrow bi bi-chevron-right"></i>
                                    </p>
                                </a>
                                <ul class="nav nav-treeview">
                                    <li class="nav-item">
                                        <a href="{{ tablero_url }}"
                                           class="nav-link ms-4 {% if request.get_full_path == tablero_url %}active{% endif %}">
                                            <i class="nav-icon bi bi-arrow-return-right"></i>
                                            <p>Ver</p>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                        {% endwith %}
                    {% endfor %}
                </ul>
            </li>
        {% endif %}
    {% endwith %}
    <!-- MENÚ LEGAJOS -->
    <li class="nav-item nav-main-item {% if 'comedores' in pagina_actual or 'admisiones' in pagina_actual or 'acompanamiento' in pagina_actual or 'rendicion_cuentas' in pagina_actual or 'organizaciones' in pagina_actual or 'cdi' in pagina_actual or 'ciudadanos' in pagina_actual or 'centros' in pagina_actual or 'celiaquia' in pagina_actual or 'expediente' in pagina_actual %}menu-open{% endif %}">
        <a href="#" class="nav-link">
            <img src="{% static 'custom/img/iconos_sidebar/legajos.svg' %}" alt="" />
            <p>
                Legajos
                <i class="nav-arrow bi bi-chevron-right"></i>
            </p>
        </a>
        <ul class="nav nav-treeview">
            <!-- CIUDADANOS -->
            {% if request.user|has_group:"Ciudadanos" %}
                <li class="nav-item {% if 'ciudadanos' in pagina_actual %}menu-open{% endif %}">
                    <a href="#"
                       class="nav-link nav-dot ms-2 {% if 'ciudadanos' in pagina_actual %}active{% endif %}">
                        <p>
                            Historia Social Digital
                            <i class="nav-arrow bi bi-chevron-right"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a href="{% url 'ciudadanos' %}"
                               class="nav-link ms-4 {% if 'ciudadanos/listar' in pagina_actual %}active{% endif %}">
                                <i class="nav-icon bi bi-arrow-return-right"></i>
                                <p>Búsqueda</p>
                            </a>
                        </li>
                    </ul>
                </li>
            {% endif %}
            <!-- COMEDORES -->
            {% if request.user|has_group:"Comedor Ver" or request.user|has_group:"Tecnico Comedor" or request.user|has_group:"Abogado Dupla" or request.user|has_group:"Area Legales" or request.user|has_group:"Area Contable" or request.user|has_group:"Comedores Listar" or request.user|has_group:"Coordinador Equipo Tecnico" or request.user|has_group:"Coordinador general" %}
                <li class="nav-item {% if 'comedores' in pagina_actual or 'admisiones' in pagina_actual or 'acompanamiento' in pagina_actual or 'rendicion_cuentas' in pagina_actual %}menu-open{% endif %}">
                    <a href="#"
                       class="nav-link nav-dot ms-2 {% if 'comedores' in pagina_actual %}active{% endif %}">
                        <p>
                            Comedores
                            <i class="nav-arrow bi bi-chevron-right"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        {% if request.user|has_group:"Comedores Listar" or request.user|has_group:"Tecnico Comedor" or request.user|has_group:"Abogado Dupla" or request.user|has_group:"Coordinador Equipo Tecnico" or request.user|has_group:"Coordinador general" %}
                            <li class="nav-item">
                                <a href="{% url 'comedores' %}"
                                   class="nav-link ms-4 {% if 'comedores/listar' in pagina_actual %}active{% endif %}">
                                    <i class="nav-icon bi bi-arrow-return-right"></i>
                                    <p>Ver Comedores</p>
                                </a>
                            </li>
                        {% endif %}
                        <!-- ADMISION -->
                        {% if request.user|has_group:"Comedores Listar" or request.user|has_group:"Tecnico Comedor" or request.user|has_group:"Abogado Dupla" or request.user|has_group:"Area Legales" or request.user|has_group:"Coordinador Equipo Tecnico" %}
                            <li class="nav-item ms-4 {% if 'admisiones' in pagina_actual %}menu-open{% endif %}">
                                <a href="#" class="nav-link">
                                    <i class="nav-icon bi bi-arrow-return-right"></i>
                                    <p>
                                        Admisión - Comedores
                                        <i class="nav-arrow bi bi-chevron-right"></i>
                                    </p>
                                </a>
                                <ul class="nav nav-treeview">
                                    {% if request.user|has_group:"Abogado Dupla" or request.user|has_group:"Tecnico Comedor" or request.user|has_group:"Coordinador Equipo Tecnico" %}
                                        <li class="nav-item">
                                            <a href="{% url 'admisiones_tecnicos_listar' %}"
                                               class="nav-link nav-dot ms-4 {% if 'admisiones/tecnicos' in pagina_actual or 'admisiones_tecnicos' in pagina_actual %}active{% endif %}">
                                                <p>Técnicos</p>
                                            </a>
                                        </li>
                                    {% endif %}
                                    {% if request.user|has_group:"Area Legales" or request.user|has_group:"Coordinador Equipo Tecnico" %}
                                        <li class="nav-item">
                                            <a href="{% url 'admisiones_legales_listar' %}"
                                               class="nav-link nav-dot ms-4 {% if 'admisiones/legales' in pagina_actual or 'admisiones_legales' in pagina_actual %}active{% endif %}">
                                                <p>Legales</p>
                                            </a>
                                        </li>
                                    {% endif %}
                                </ul>
                            </li>
                        {% endif %}
                        <!-- ACOMPAÑAMIENTO -->
                        {% if request.user|has_group:"Area Legales" or request.user|has_group:"Tecnico Comedor" or request.user|has_group:"Abogado Dupla" or request.user|has_group:"Coordinador Equipo Tecnico" %}
                            <li class="nav-item">
                                <a href="{% url 'lista_comedores_acompanamiento' %}"
                                   class="nav-link ms-4 {% if 'acompanamiento' in pagina_actual %}active{% endif %}">
                                    <i class="nav-icon bi bi-arrow-return-right"></i>
                                    <p>Acompañamiento</p>
                                </a>
                            </li>
                        {% endif %}
                        {% comment %}
                        <!-- RENDICIÓN DE CUENTAS FINAL -->
                        {% if request.user|has_group:"Area Legales" or request.user|has_group:"Area Contable" or request.user|has_group:"Tecnico Comedor" or request.user|has_group:"Coordinador Equipo Tecnico" %}
                            <li class="nav-item">
                                <a href="{% url 'rendicion_cuentas_final_listar' %}" class="nav-link ms-4 {% if 'rendicion_cuentas_final/listar' in pagina_actual %}active{% endif %}">
                                    <i class="nav-icon bi bi-arrow-return-right"></i>
                                    <p>Rendición de Cuentas Final</p>
                                </a>
                            </li>
                        {% endif %}
                        {% endcomment %}
                    </ul>
                </li>
            {% endif %}
            <!-- ORGANIZACIONES -->
            {% if request.user|has_group:"Organizaciones" %}
                <li class="nav-item {% if 'organizaciones' in pagina_actual %}menu-open{% endif %}">
                    <a href="#"
                       class="nav-link nav-dot ms-2 {% if 'organizaciones' in pagina_actual %}active{% endif %}">
                        <p>
                            Organizaciones
                            <i class="nav-arrow bi bi-chevron-right"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a href="{% url 'organizaciones' %}"
                               class="nav-link ms-4 {% if 'organizaciones/listar' in pagina_actual %}active{% endif %}">
                                <i class="nav-icon bi bi-arrow-return-right"></i>
                                <p>Ver Organizaciones</p>
                            </a>
                        </li>
                    </ul>
                </li>
            {% endif %}

            {% if request.user|has_group:"Importar Expediente" %}
                <li class="nav-item {% if 'importarexpediente' in pagina_actual %}menu-open{% endif %}">
                    <a href="#"
                       class="nav-link nav-dot ms-2 {% if 'importarexpediente' in pagina_actual %}active{% endif %}">
                        <p>
                            Importar Expediente de Pago
                            <i class="nav-arrow bi bi-chevron-right"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a href="{% url 'importarexpedientes_list' %}"
                               class="nav-link ms-4 {% if 'importarexpediente/listar' in pagina_actual %}active{% endif %}">
                                <i class="nav-icon bi bi-arrow-return-right"></i>
                                <p>Ver Importar Expediente de Pago</p>
                            </a>
                        </li>
                    </ul>
                </li>
            {% endif %}


            <!-- CDI -->
            {% if request.user|has_group:"CDI" %}
                <li class="nav-item {% if 'cdi' in pagina_actual %}menu-open{% endif %}">
                    <a href="#"
                       class="nav-link nav-dot ms-2 {% if 'cdi' in pagina_actual %}active{% endif %}">
                        <p>
                            Centro Desarrollo Infantil
                            <i class="nav-arrow bi bi-chevron-right"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a href="{% url 'cdi' %}"
                               class="nav-link ms-4 {% if 'cdi/listar' in pagina_actual %}active{% endif %}">
                                <i class="nav-icon bi bi-arrow-return-right"></i>
                                <p>Ver Centro Desarrollo</p>
                            </a>
                        </li>
                    </ul>
                </li>
            {% endif %}
            <!-- CENTRO DE FAMILIA -->
            {% if request.user|has_group:"superadmin" or request.user|has_group:"ReferenteCentro" or request.user|has_group:"CDF SSE" %}
                <li class="nav-item {% if 'centros' in pagina_actual %}menu-open{% endif %}">
                    <a href="#"
                       class="nav-link nav-dot {% if 'centros' in pagina_actual %}active{% endif %} ms-2">
                        <p>
                            Centro de Familia
                            <i class="nav-arrow bi bi-chevron-right"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a href="{% url 'centro_list' %}"
                               class="nav-link {% if 'centros/' in pagina_actual %}active{% endif %} ms-4">
                                <i class="nav-icon bi bi-arrow-return-right"></i>
                                <p>Centros</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{% url 'beneficiarios_crear' %}"
                               class="nav-link {% if 'beneficiarios/nuevo' in pagina_actual %}active{% endif %} ms-4">
                                <i class="nav-icon bi bi-arrow-return-right"></i>
                                <p>Nuevo Preinscripto</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{% url 'beneficiarios_list' %}"
                               class="nav-link {% if 'beneficiarios/beneficiarios' in pagina_actual %}active{% endif %} ms-4">
                                <i class="nav-icon bi bi-arrow-return-right"></i>
                                <p>Lista de Preinscriptos</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{% url 'responsables_list' %}"
                               class="nav-link {% if 'beneficiarios/responsables' in pagina_actual %}active{% endif %} ms-4">
                                <i class="nav-icon bi bi-arrow-return-right"></i>
                                <p>Lista Responsables</p>
                            </a>
                        </li>
                    </ul>
                </li>
            {% endif %}
            <!-- CELIAQUÍA -->
            {% if request.user|has_group:"TecnicoCeliaquia" or request.user|has_group:"CoordinadorCeliaquia" or request.user|has_group:"ProvinciaCeliaquia" or request.user.is_superuser %}
                <li class="nav-item">
                    <a href="#" class="nav-link nav-dot ms-2">
                        <p>
                            Celiaquía
                            <i class="nav-arrow bi bi-chevron-right"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a href="{% url 'expediente_list' %}" class="nav-link ms-2">
                                <i class="nav-icon fas fa-folder-open"></i>
                                <p>Expedientes</p>
                            </a>
                        </li>
                        {% if request.user|has_group:"CoordinadorCeliaquia" %}
                            <li class="nav-item">
                                <a href="{% url 'cupo_dashboard' %}" class="nav-link ms-2">
                                    <i class="nav-icon fas fa-chart-bar"></i>
                                    <p>Dashboard Cupos</p>
                                </a>
                            </li>
                        {% endif %}
                        {% if request.user|has_group:"CoordinadorCeliaquia" or request.user|has_group:"TecnicoCeliaquia" %}
                            <li class="nav-item">
                                <a href="{% url 'reporter_provincias' %}" class="nav-link ms-2">
                                    <i class="nav-icon fas fa-chart-pie"></i>
                                    <p>Reporte</p>
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                </li>
            {% endif %}
        </ul>
    </li>
{% endwith %}
