{% extends "includes/main.html" %}
{% load static %}
{% block title %}Organizacion: {{ organizacion.nombre }}{% endblock %}
{% block titulo-pagina %}
    {{ organizacion.nombre }}
    <span class="ml-2 h5">| {{ organizacion.cuit | default_if_none:"Sin información" }}</span>
{% endblock %}
{% block breadcrumb %}
    <ol class="breadcrumb float-sm-right">
        <div class="breadcrumb-item">
            <a href="{% url 'organizaciones' %}">Organizaciones</a>
        </div>
        <div class="breadcrumb-item active">{{ organizacion.nombre }}</div>
    </ol>
{% endblock %}
{% block content %}
    <link rel="stylesheet" href="{% static 'custom/css/cardsDetail.css' %}" />
    <link rel="stylesheet"
          href="{% static 'custom/css/comedorRelevamiento.css' %}" />
    <div class="row justify-content-between d-print-none mx-1 mb-3">
        <div class="col-auto">
            <a href="{% url 'organizaciones' %}"
               class="btn btn-secondary mr-1 backbutton-handler">Volver</a>
        </div>
        <div class="col-auto">
            {% if perms.auditlog.view_logentry %}
                <a href="{% url 'audittrail:log_instance' 'organizaciones' 'organizacion' organizacion.pk %}"
                   class="btn btn-outline-secondary mr-1">Historial</a>
            {% endif %}
            <a href="{% url 'organizacion_editar' organizacion.id %}"
               class="btn btn-primary mr-1">Editar</a>
            <a href="{% url 'organizacion_eliminar' organizacion.id %}"
               class="btn btn-danger">Eliminar</a>
        </div>
    </div>
    {% include 'components/info_card.html' with title='Información de la organizacion' items=data_items list_style=True col_class="col-md-6" card_class="card-outline card-primary h-100" %}
    <div class="row justify-content-between d-print-none mx-1 mb-3 mt-4">
        <div class="col-auto">
            <h4 style="display: inline;">Firmantes</h4>
        </div>
        <div class="col-auto">
            <a href="{% url 'firmante_crear' organizacion.id %}"
               class="btn btn-primary mr-1">Agregar Firmante</a>
        </div>
    </div>
    {% include 'components/data_table.html' with headers=table_headers items=firmantes fields=table_fields actions=actions show_actions=show_actions empty_message='No hay firmantes registrados.' %}
    {% if is_paginated %}
        {% include 'components/pagination.html' %}
    {% endif %}
    {% if avales %}
        <div class="row justify-content-between d-print-none mx-1 mb-3 mt-4">
            <div class="col-auto">
                <h4 style="display: inline;">Aval</h4>
            </div>
            <div class="col-auto">
                <a href="{% url 'aval_crear' organizacion.id %}"
                   class="btn btn-primary mr-1">Agregar Aval</a>
            </div>
        </div>
        {% include 'components/data_table.html' with headers=table_headers_avales items=avales_data fields=table_fields_avales actions=actions_avales show_actions=show_actions empty_message='No hay avales registrados.' %}
        {% if is_paginated %}
            {% include 'components/pagination.html' %}
        {% endif %}
    {% endif %}
    <div class="row justify-content-between d-print-none mx-1 mb-3 mt-4">
        <div class="col-auto">
            <h4 style="display: inline;">Comedores asociados: {{ comedores_count }}</h4>
        </div>
    </div>
    {% if comedores %}
        <div class="row mt-3 max-width-100">
            <div class="col-12">
                <div class="card comedor-table-card">
                    <div class="card-body">
                        <table class="table table-comedor-moderno">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Tipo</th>
                                    <th>Ubicación</th>
                                    <th>Dirección</th>
                                    <th>Referente</th>
                                    <th>Validación</th>
                                    <th class="notexport">Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for comedor in comedores %}
                                    <tr>
                                        <td>
                                            <a href="{% url 'comedor_detalle' comedor.id %}"
                                               class="link-handler"
                                               title="Ver detalles de {{ comedor.nombre }}">{{ comedor.nombre }}</a>
                                        </td>
                                        <td>{{ comedor.tipocomedor.nombre | default_if_none:"Sin información" }}</td>
                                        <td>
                                            <div class="ubicacion-info">
                                                <div class="ubicacion-item">{{ comedor.provincia.nombre | default_if_none:"Sin provincia" }}</div>
                                                <div class="ubicacion-item">
                                                    {{ comedor.municipio.nombre | default_if_none:"Sin municipio" }} / {{ comedor.localidad.nombre | default_if_none:"Sin localidad" }}
                                                </div>
                                                {% if comedor.barrio %}<div class="ubicacion-item">{{ comedor.barrio }}</div>{% endif %}
                                            </div>
                                        </td>
                                        <td>{{ comedor.calle | default_if_none:"Sin calle" }} {{ comedor.numero | default_if_none:"S/N" }}</td>
                                        <td>
                                            {% if comedor.referente %}
                                                {{ comedor.referente.nombre | default_if_none:"Sin" }} {{ comedor.referente.apellido | default_if_none:"información" }}
                                            {% else %}
                                                Sin información
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if comedor.estado_validacion == "Validado" %}
                                                <span class="badge-validacion validado">
                                                    <i class="fas fa-check-circle"></i>
                                                    Validado
                                                </span>
                                                {% if comedor.fecha_validado %}
                                                    <small class="fecha-validacion">{{ comedor.fecha_validado|date:"d/m/Y" }}</small>
                                                {% endif %}
                                            {% elif comedor.estado_validacion == "No Validado" %}
                                                <span class="badge-validacion no-validado">
                                                    <i class="fas fa-times-circle"></i>
                                                    No Validado
                                                </span>
                                                {% if comedor.fecha_validado %}
                                                    <small class="fecha-validacion">{{ comedor.fecha_validado|date:"d/m/Y" }}</small>
                                                {% endif %}
                                            {% else %}
                                                <span class="badge-validacion pendiente">
                                                    <i class="fas fa-clock"></i>
                                                    Pendiente
                                                </span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="comedor-actions">
                                                <a href="{% url 'comedor_detalle' comedor.id %}"
                                                   class="btn btn-ver link-handler"
                                                   title="Ver detalles">
                                                    <i class="fas fa-eye"></i>
                                                    Ver
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <div class="row mt-3">
            <div class="col-12">
                <div class="alert alert-info">
                    No hay comedores asociados a esta organización.
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}
